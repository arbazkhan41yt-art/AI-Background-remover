<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Background Remover | Clean & Fast</title>
    <script src="https://cdn.tailwindcss.com "></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300 ;400;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }

        .drop-zone {
            border: 2px dashed #cbd5e1;
            transition: all 0.3s ease;
        }

        .drop-zone.drag-over {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }

        .loader {
            border-top-color: #3b82f6;
            animation: spinner 1.5s linear infinite;
        }

        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .checkered-bg {
            background-image: linear-gradient(45deg, #e2e8f0 25%, transparent 25%),
                              linear-gradient(-45deg, #e2e8f0 25%, transparent 25%),
                              linear-gradient(45deg, transparent 75%, #e2e8f0 75%),
                              linear-gradient(-45deg, transparent 75%, #e2e8f0 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }

        /* Quality Option Styles */
        .quality-option {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .quality-option:hover {
            background-color: #f1f5f9;
        }

        .enhanced-badge {
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            color: white;
            padding: 2px 8px;
            border-radius: 99px;
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
        }

        /* Toggle Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 14px; width: 14px;
            left: 3px; bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: #10b981; }
        input:checked + .slider:before { transform: translateX(20px); }

        /* Comparison Slider Styles */
        .comparison-container {
            position: relative;
            width: 100%;
            overflow: hidden;
            border-radius: 12px;
        }
        .before-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 50%;
            height: 100%;
            overflow: hidden;
            border-right: 2px solid white;
            z-index: 10;
        }
        .before-overlay img {
            width: 100%; 
            height: 100%;
            object-fit: contain;
        }
        .slider-handle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
            z-index: 20;
            pointer-events: none;
        }
        .comparison-input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: ew-resize;
            z-index: 30;
        }

        /* Visitor Dashboard Styles */
        .visitor-dashboard {
            border-top: 1px solid #e2e8f0;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
        }
        .visitor-stat {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: #f8fafc;
            border-radius: 9999px;
            font-size: 0.75rem;
            color: #64748b;
        }
        .visitor-stat svg {
            width: 14px;
            height: 14px;
            color: #94a3b8;
        }
        .visitor-count {
            font-weight: 600;
            color: #475569;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header Section -->
    <header class="w-full py-6 px-4 bg-white border-b border-slate-200">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                </div>
                <span class="text-xl font-bold text-slate-800 tracking-tight">AI Remover <span class="text-blue-600">PRO</span></span>
            </div>
            
            <!-- Stock Safe Toggle -->
            <div class="flex items-center gap-3 bg-slate-50 px-4 py-2 rounded-full border border-slate-200">
                <div class="flex flex-col items-end">
                    <span class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Stock-Safe Mode</span>
                    <span id="stockStatusLabel" class="text-[9px] text-slate-400">Natural Approval Quality</span>
                </div>
                <label class="switch">
                    <input type="checkbox" id="stockSafeToggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
        </div>
    </header>

    <main class="flex-grow max-w-6xl mx-auto w-full px-4 py-12">
        <div class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-extrabold text-slate-900 mb-4">Remove & Enhance Backgrounds</h1>
            <p class="text-lg text-slate-600">Lightly enhanced detail reconstruction for crisp results</p>
        </div>

        <!-- Main Remover Tool -->
        <div id="uploadContainer" class="max-w-3xl mx-auto bg-white rounded-2xl shadow-xl p-8 border border-slate-100 mb-12">
            <div id="dropZone" class="drop-zone rounded-xl p-12 text-center cursor-pointer flex flex-col items-center justify-center">
                <div class="w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mb-4">
                    <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                </div>
                <h3 class="text-xl font-semibold text-slate-800 mb-2">Drag & drop your image</h3>
                <p class="text-slate-500 mb-6">Subject will be isolated with light texture preservation</p>
                <button onclick="document.getElementById('fileInput').click()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-full transition-all transform hover:scale-105">
                    Upload & Process
                </button>
                <input type="file" id="fileInput" class="hidden" accept="image/*">
            </div>
        </div>

        <div id="processingContainer" class="hidden max-w-3xl mx-auto text-center py-12">
            <div class="loader ease-linear rounded-full border-4 border-t-4 border-slate-200 h-16 w-16 mx-auto mb-4"></div>
            <p class="text-xl font-medium text-slate-700" id="statusText">Removing background...</p>
        </div>

        <div id="resultContainer" class="hidden max-w-6xl mx-auto grid md:grid-cols-3 gap-8 items-start mb-24">
            <!-- Original Preview (Absolute Original) -->
            <div class="space-y-4">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-slate-700">Before</h3>
                    <span class="text-xs text-slate-400" id="origDimLabel"></span>
                </div>
                <div class="rounded-xl overflow-hidden border border-slate-200 bg-white">
                    <img id="originalPreview" class="w-full h-auto object-contain max-h-[400px]" src="" alt="Before">
                </div>
                <div class="text-center">
                    <span class="text-sm font-medium text-slate-500">Label: Before</span>
                </div>
            </div>

            <!-- Enhanced Preview with Comparison Slider -->
            <div class="space-y-4">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-slate-700">Side-by-Side</h3>
                    <span id="qualityBadge" class="enhanced-badge">CRISP DETAIL</span>
                </div>
                <div class="rounded-xl overflow-hidden border border-slate-200 checkered-bg flex items-center justify-center bg-white min-h-[300px] comparison-container" id="comparisonContainer">
                    <!-- Base Layer (Lightly Enhanced/After) -->
                    <img id="resultPreview" class="w-full h-auto object-contain max-h-[400px]" src="" alt="After">
                    
                    <!-- Top Layer (Absolute Original/Before) -->
                    <div id="beforeOverlay" class="before-overlay">
                        <img id="beforeOverlayImg" src="" alt="Before">
                    </div>
                    
                    <!-- Handle -->
                    <div id="sliderHandle" class="slider-handle">
                        <svg class="w-6 h-6 text-slate-400" fill="currentColor" viewBox="0 0 24 24"><path d="M8 7l-5 5 5 5V7zm8 0l5 5-5 5V7z"/></svg>
                    </div>
                    
                    <!-- Interaction Input -->
                    <input type="range" min="0" max="100" value="50" class="comparison-input" id="comparisonInput">
                    
                    <!-- Labels -->
                    <div class="absolute bottom-2 left-2 z-20 bg-black/50 text-white text-[10px] px-2 py-1 rounded">ORIGINAL</div>
                    <div class="absolute bottom-2 right-2 z-20 bg-blue-600/70 text-white text-[10px] px-2 py-1 rounded">PROCESSED</div>
                </div>
                <div class="text-center">
                    <span class="text-sm font-medium text-slate-500">Label: After</span>
                </div>
            </div>

            <!-- Enhanced Download Options -->
            <div class="space-y-4">
                <h3 class="text-lg font-semibold text-slate-700">Download Options</h3>
                <div class="bg-white border border-slate-200 rounded-xl overflow-hidden shadow-sm">
                    <!-- Low Quality -->
                    <div onclick="downloadWithQuality(0.5)" class="quality-option p-4 border-b border-slate-100 flex justify-between items-center group">
                        <span class="font-mono text-slate-600" id="res-low">--- × ---</span>
                        <div class="text-right">
                            <span class="text-sm block font-medium text-slate-500">Low Quality</span>
                            <span class="text-[10px] text-slate-400">Optimized file size</span>
                        </div>
                    </div>
                    <!-- Medium Quality -->
                    <div onclick="downloadWithQuality(1.0)" class="quality-option p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                        <span class="font-mono text-slate-800 font-bold" id="res-med">--- × ---</span>
                        <div class="text-right">
                            <span class="text-sm block font-medium text-slate-700">Medium Quality</span>
                            <span id="medLabel" class="text-[10px] text-blue-500 font-bold uppercase">Natural Detail</span>
                        </div>
                    </div>
                    <!-- High Quality -->
                    <div onclick="downloadWithQuality(2.0)" class="quality-option p-4 flex justify-between items-center bg-blue-50/30">
                        <span class="font-mono text-blue-700 font-bold" id="res-high">--- × ---</span>
                        <div class="text-right">
                            <span class="text-sm block font-bold text-blue-600">High Quality</span>
                            <span id="highLabel" class="text-[10px] text-blue-500 font-bold uppercase">Maximum Crispness</span>
                        </div>
                    </div>
                </div>
                <div class="p-4 bg-blue-50 rounded-lg border border-blue-100 flex gap-3">
                    <svg class="w-5 h-5 text-blue-600 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                    <p class="text-xs text-blue-700" id="infoBoxText">Minimal processing to preserve original sharpness and texture.</p>
                </div>
                <button onclick="resetUI()" class="w-full mt-4 text-slate-500 text-sm hover:underline font-medium">Clear & Upload Another</button>
            </div>
        </div>
    </main>

    <footer class="w-full py-8 text-center text-slate-400 text-sm border-t border-slate-200 bg-white mt-auto">
        <div class="max-w-6xl mx-auto px-4">
            <p>&copy; 2026 AI Background Remover Pro. Preserving Original Detail.</p>
            
            <!-- Visitor Dashboard -->
            <div class="visitor-dashboard">
                <div class="flex flex-wrap justify-center gap-3">
                    <div class="visitor-stat" title="Total visitors since launch">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                        <span>Total: <span class="visitor-count" id="totalVisitors">0</span></span>
                    </div>
                    <div class="visitor-stat" title="Visitors today">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span>Today: <span class="visitor-count" id="todayVisitors">0</span></span>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <script>
        const API_KEY = 'qCG46ABJzc91h5kUintKBm2q';
        
        const fileInput = document.getElementById('fileInput');
        const dropZone = document.getElementById('dropZone');
        const stockSafeToggle = document.getElementById('stockSafeToggle');
        const uploadContainer = document.getElementById('uploadContainer');
        const processingContainer = document.getElementById('processingContainer');
        const resultContainer = document.getElementById('resultContainer');
        const originalPreview = document.getElementById('originalPreview');
        const resultPreview = document.getElementById('resultPreview');
        const beforeOverlayImg = document.getElementById('beforeOverlayImg');
        const statusText = document.getElementById('statusText');
        const qualityBadge = document.getElementById('qualityBadge');
        const infoBoxText = document.getElementById('infoBoxText');
        
        const comparisonInput = document.getElementById('comparisonInput');
        const beforeOverlay = document.getElementById('beforeOverlay');
        const sliderHandle = document.getElementById('sliderHandle');

        let rawIsolatedImage = new Image();
        let enhancedImageCanvas = null; 
        let originalWidth = 0;
        let originalHeight = 0;

        // Visual Comparison Slider Logic
        comparisonInput.addEventListener('input', (e) => {
            const val = e.target.value;
            beforeOverlay.style.width = `${val}%`;
            sliderHandle.style.left = `${val}%`;
        });

        stockSafeToggle.addEventListener('change', () => {
            const isSafe = stockSafeToggle.checked;
            document.getElementById('stockStatusLabel').innerText = isSafe ? "Natural Approval Quality" : "Aggressive AI Mode";
            qualityBadge.innerText = isSafe ? "NATURAL" : "SHARPENED";
            infoBoxText.innerText = isSafe 
                ? "Minimal processing to preserve original sharpness and texture." 
                : "Aggressive detail recovery. Sharpness boosted while guarding texture.";
            
            if (rawIsolatedImage.src) {
                applyAIEnhancement();
            }
        });

        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('drag-over'); });
        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
            if (e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length) handleFile(e.target.files[0]);
        });

        function handleFile(file) {
            processImage(file);
        }

        async function processImage(file) {
            uploadContainer.classList.add('hidden');
            processingContainer.classList.remove('hidden');
            statusText.innerText = "Removing background...";
            
            const fileUrl = URL.createObjectURL(file);
            const imgForDim = new Image();
            imgForDim.src = fileUrl;
            imgForDim.onload = () => {
                originalWidth = imgForDim.width;
                originalHeight = imgForDim.height;
                document.getElementById('origDimLabel').innerText = `${originalWidth} × ${originalHeight}`;
                updateResolutionLabels(originalWidth, originalHeight);
                // Set the "Before" (Original Image)
                originalPreview.src = fileUrl;
                beforeOverlayImg.src = fileUrl;
            };

            const formData = new FormData();
            formData.append('image_file', file);
            formData.append('size', 'auto');

            try {
                const response = await fetch('https://api.remove.bg/v1.0/removebg ', {
                    method: 'POST',
                    headers: { 'X-Api-Key': API_KEY },
                    body: formData
                });
                if (response.ok) {
                    statusText.innerText = "Enhancing Original Details...";
                    const blob = await response.blob();
                    const url = URL.createObjectURL(blob);
                    
                    rawIsolatedImage.onload = () => {
                        applyAIEnhancement();
                    };
                    rawIsolatedImage.src = url;
                } else {
                    alert('Error processing image. Check API key status.');
                    resetUI();
                }
            } catch (error) {
                alert('Network error.');
                resetUI();
            }
        }

        /**
         * Light enhancement logic focusing on preserving original detail 
         * and texture as per "Smart Master Prompt".
         */
        function applyAIEnhancement() {
            const isStockSafe = stockSafeToggle.checked;
            const canvas = document.createElement('canvas');
            const w = rawIsolatedImage.width;
            const h = rawIsolatedImage.height;
            canvas.width = w;
            canvas.height = h;
            const ctx = canvas.getContext('2d');
            
            ctx.drawImage(rawIsolatedImage, 0, 0);
            
            const imageData = ctx.getImageData(0, 0, w, h);
            const data = imageData.data;
            const enhancedData = new Uint8ClampedArray(data);
            
            // Light enhancement coefficients - tuned for detail preservation
            const sharpnessStrength = isStockSafe ? 0.04 : 0.12; 
            const textureClarity = isStockSafe ? 1.01 : 1.04;

            for (let i = 0; i < data.length; i += 4) {
                if (data[i+3] < 2) continue;

                for (let j = 0; j < 3; j++) {
                    const val = data[i + j];
                    // Very light sharpening to avoid over-smoothing/blurring
                    let newVal = val + (val - 128) * sharpnessStrength;
                    // Light clarity scaling
                    newVal *= textureClarity;
                    
                    enhancedData[i + j] = Math.min(255, Math.max(0, newVal));
                }
                enhancedData[i+3] = data[i+3];
            }
            
            ctx.putImageData(new ImageData(enhancedData, w, h), 0, 0);
            
            enhancedImageCanvas = canvas;
            resultPreview.src = canvas.toDataURL('image/png');
            
            // Sync overlay image width
            beforeOverlayImg.style.width = resultPreview.offsetWidth + "px";

            processingContainer.classList.add('hidden');
            resultContainer.classList.remove('hidden');
        }

        function updateResolutionLabels(w, h) {
            document.getElementById('res-low').innerText = `${Math.round(w * 0.5)} × ${Math.round(h * 0.5)}`;
            document.getElementById('res-med').innerText = `${w} × ${h}`;
            document.getElementById('res-high').innerText = `${w * 2} × ${h * 2}`;
        }

        function downloadWithQuality(scale) {
            if (!enhancedImageCanvas) return;

            const finalCanvas = document.createElement('canvas');
            const targetWidth = originalWidth * scale;
            const targetHeight = originalHeight * scale;
            
            finalCanvas.width = targetWidth;
            finalCanvas.height = targetHeight;
            
            const ctx = finalCanvas.getContext('2d');
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = 'high';
            
            ctx.drawImage(enhancedImageCanvas, 0, 0, targetWidth, targetHeight);
            
            const mode = stockSafeToggle.checked ? 'natural' : 'sharp';
            const link = document.createElement('a');
            link.download = `isolated-${mode}-${targetWidth}x${targetHeight}.png`;
            link.href = finalCanvas.toDataURL('image/png');
            link.click();
        }

        function resetUI() {
            uploadContainer.classList.remove('hidden');
            processingContainer.classList.add('hidden');
            resultContainer.classList.add('hidden');
            fileInput.value = "";
            enhancedImageCanvas = null;
            rawIsolatedImage = new Image();
            comparisonInput.value = 50;
            beforeOverlay.style.width = "50%";
            sliderHandle.style.left = "50%";
        }

        window.addEventListener('resize', () => {
            if (resultPreview.src) {
                beforeOverlayImg.style.width = resultPreview.offsetWidth + "px";
            }
        });

        // Visitor Dashboard Tracking Logic
        (function initVisitorTracking() {
            const STORAGE_KEY = 'aiRemoverVisitorData';
            const SESSION_KEY = 'aiRemoverSessionTracked';
            
            // Get or initialize visitor data
            let visitorData = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
                total: 0,
                lastVisitDate: null,
                dailyVisits: {}
            };
            
            const today = new Date().toISOString().split('T')[0];
            const sessionTracked = sessionStorage.getItem(SESSION_KEY);
            
            // Only count if this session hasn't been tracked yet
            if (!sessionTracked) {
                // Increment total visitors
                visitorData.total++;
                
                // Initialize today's count if not exists
                if (!visitorData.dailyVisits[today]) {
                    visitorData.dailyVisits[today] = 0;
                }
                visitorData.dailyVisits[today]++;
                
                // Update last visit date
                visitorData.lastVisitDate = today;
                
                // Clean up old daily data (keep last 30 days only)
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                const cutoffDate = thirtyDaysAgo.toISOString().split('T')[0];
                
                Object.keys(visitorData.dailyVisits).forEach(date => {
                    if (date < cutoffDate) {
                        delete visitorData.dailyVisits[date];
                    }
                });
                
                // Save updated data
                localStorage.setItem(STORAGE_KEY, JSON.stringify(visitorData));
                sessionStorage.setItem(SESSION_KEY, 'true');
            }
            
            // Update display
            const totalVisitorsEl = document.getElementById('totalVisitors');
            const todayVisitorsEl = document.getElementById('todayVisitors');
            
            if (totalVisitorsEl) {
                totalVisitorsEl.textContent = visitorData.total.toLocaleString();
            }
            if (todayVisitorsEl) {
                todayVisitorsEl.textContent = (visitorData.dailyVisits[today] || 0).toLocaleString();
            }
        })();
    </script>
</body>
</html>